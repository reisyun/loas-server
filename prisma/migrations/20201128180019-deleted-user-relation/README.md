# Migration `20201128180019-deleted-user-relation`

This migration has been generated by reisyun at 11/29/2020, 3:00:22 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "collection" DROP CONSTRAINT "collection_collectorId_fkey1"

ALTER TABLE "profile" DROP CONSTRAINT "profile_userId_fkey1"

ALTER TABLE "collection" ADD COLUMN     "deletedCollectorId" TEXT

ALTER TABLE "profile" ADD COLUMN     "deletedUserId" TEXT

CREATE UNIQUE INDEX "profile_deletedUserId_unique" ON "profile"("deletedUserId")

ALTER TABLE "collection" ADD FOREIGN KEY("deletedCollectorId")REFERENCES "user_deleted"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "profile" ADD FOREIGN KEY("deletedUserId")REFERENCES "user_deleted"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201128165158-initialize-domains..20201128180019-deleted-user-relation
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -63,11 +63,12 @@
   createdAt DateTime  @default(now())
   updatedAt DateTime  @default(now()) @updatedAt
   removedAt DateTime?
-  user        User?        @relation(fields: [userId], references: [id])
-  userId      String?
-  deletedUser DeletedUser? @relation(fields: [userId], references: [id])
+  user          User?        @relation(fields: [userId], references: [id])
+  userId        String?
+  deletedUser   DeletedUser? @relation(fields: [deletedUserId], references: [id])
+  deletedUserId String?
   @@map(name: "profile")
 }
@@ -103,12 +104,13 @@
   createdAt   DateTime           @default(now())
   updatedAt   DateTime           @default(now()) @updatedAt
   removedAt   DateTime?
-  collector        User?            @relation(fields: [collectorId], references: [id])
-  collectorId      String?
-  deletedCollector DeletedUser?     @relation(fields: [collectorId], references: [id])
-  collectionItems  CollectionItem[]
+  collector          User?            @relation(fields: [collectorId], references: [id])
+  collectorId        String?
+  deletedCollector   DeletedUser?     @relation(fields: [deletedCollectorId], references: [id])
+  deletedCollectorId String?
+  collectionItems    CollectionItem[]
   @@map(name: "collection")
 }
```


