# Migration `20210211132506-add-profile`

This migration has been generated by reisyun at 2/11/2021, 10:25:08 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "user" DROP COLUMN "gender",
DROP COLUMN "language"

CREATE TABLE "user_profile" (
    "shortBio" TEXT,
    "avatar" TEXT,
    "gender" "Gender" NOT NULL DEFAULT E'SECRET',
    "language" "Language" NOT NULL DEFAULT E'ENGLISH',
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "userId" TEXT NOT NULL,

    PRIMARY KEY ("userId")
)

CREATE UNIQUE INDEX "user_profile_userId_unique" ON "user_profile"("userId")

ALTER TABLE "user_profile" ADD FOREIGN KEY("userId")REFERENCES "user"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210211125458-initial..20210211132506-add-profile
--- datamodel.dml
+++ datamodel.dml
@@ -1,15 +1,31 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
 // User
+model User {
+  id       String @id @default(uuid())
+  name     String @unique
+  email    String @unique
+  password String
+
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+  removedAt DateTime?
+
+  profile   UserProfile?
+  histories History[]
+
+  @@map(name: "user")
+}
+
 enum Gender {
   SECRET
   MALE
   FEMALE
@@ -20,23 +36,21 @@
   ENGLISH
   JAPANESE
 }
-model User {
-  id       String   @id @default(uuid())
-  name     String   @unique
-  email    String   @unique
-  password String
-  gender   Gender
-  language Language
+model UserProfile {
+  shortBio String?
+  avatar   String?
+  gender   Gender   @default(SECRET)
+  language Language @default(ENGLISH)
-  createdAt DateTime  @default(now())
-  updatedAt DateTime  @updatedAt
-  removedAt DateTime?
+  updatedAt DateTime @updatedAt
-  histories History[]
+  user   User   @relation(fields: [userId], references: [id])
+  userId String
-  @@map(name: "user")
+  @@id(userId)
+  @@map(name: "user_profile")
 }
 // History
```


