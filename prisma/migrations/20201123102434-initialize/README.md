# Migration `20201123102434-initialize`

This migration has been generated by reisyun at 11/23/2020, 7:24:40 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."UserRole" AS ENUM ('USER', 'ADMIN')

CREATE TYPE "public"."Gender" AS ENUM ('SECRET', 'MALE', 'FEMALE')

CREATE TYPE "public"."Language" AS ENUM ('KOREAN', 'ENGLISH', 'JAPANESE')

CREATE TYPE "public"."MediaItemStatus" AS ENUM ('CURRENT', 'PLANNING', 'COMPLETED')

CREATE TYPE "public"."Format" AS ENUM ('TVA', 'OVA', 'ONA', 'MOVIE', 'MUSIC', 'SPECIAL')

CREATE TYPE "public"."MediaStatus" AS ENUM ('RELEASING', 'FINISHED', 'UNRELEASED', 'CANCELLED')

CREATE TABLE "user" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "password" TEXT NOT NULL,
    "verified" BOOLEAN NOT NULL DEFAULT false,
    "role" "UserRole" NOT NULL DEFAULT E'USER',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "removedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "profile" (
"id" SERIAL,
    "shortBio" TEXT,
    "avatar" TEXT,
    "gender" "Gender" NOT NULL DEFAULT E'SECRET',
    "language" "Language" NOT NULL DEFAULT E'ENGLISH',
    "userId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "review" (
    "id" TEXT NOT NULL,
    "content" TEXT NOT NULL,
    "spoiler" BOOLEAN NOT NULL DEFAULT true,
    "private" BOOLEAN NOT NULL DEFAULT false,
    "likeCount" INTEGER NOT NULL DEFAULT 0,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" TEXT NOT NULL,
    "mediaId" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "media_collection" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "description" TEXT,
    "isCustom" BOOLEAN NOT NULL DEFAULT true,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "removedAt" TIMESTAMP(3),
    "userId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "media_item" (
"id" SERIAL,
    "status" "MediaItemStatus" NOT NULL DEFAULT E'PLANNING',
    "like" BOOLEAN,
    "private" BOOLEAN NOT NULL DEFAULT false,
    "repeat" INTEGER NOT NULL DEFAULT 0,
    "completedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "collectionId" TEXT NOT NULL,
    "mediaId" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "media" (
"id" SERIAL,
    "title" TEXT NOT NULL,
    "image" TEXT,
    "likeCount" INTEGER NOT NULL DEFAULT 0,
    "dislikeCount" INTEGER NOT NULL DEFAULT 0,
    "synopsis" TEXT,
    "studio" TEXT,
    "format" "Format",
    "startDate" TIMESTAMP(3),
    "endDate" TIMESTAMP(3),
    "episodeCount" INTEGER,
    "status" "MediaStatus",
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "removedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "genre" (
"id" SERIAL,
    "name" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_GenreToMedia" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE UNIQUE INDEX "user.email_unique" ON "user"("email")

CREATE UNIQUE INDEX "profile.userId_unique" ON "profile"("userId")

CREATE UNIQUE INDEX "review.mediaId_unique" ON "review"("mediaId")

CREATE UNIQUE INDEX "media_item.mediaId_unique" ON "media_item"("mediaId")

CREATE INDEX "media.title_studio_index" ON "media"("title", "studio")

CREATE UNIQUE INDEX "_GenreToMedia_AB_unique" ON "_GenreToMedia"("A", "B")

CREATE INDEX "_GenreToMedia_B_index" ON "_GenreToMedia"("B")

ALTER TABLE "profile" ADD FOREIGN KEY("userId")REFERENCES "user"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "review" ADD FOREIGN KEY("userId")REFERENCES "user"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "review" ADD FOREIGN KEY("mediaId")REFERENCES "media"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "media_collection" ADD FOREIGN KEY("userId")REFERENCES "user"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "media_item" ADD FOREIGN KEY("collectionId")REFERENCES "media_collection"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "media_item" ADD FOREIGN KEY("mediaId")REFERENCES "media"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_GenreToMedia" ADD FOREIGN KEY("A")REFERENCES "genre"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_GenreToMedia" ADD FOREIGN KEY("B")REFERENCES "media"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201123102434-initialize
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,163 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum UserRole {
+  USER
+  ADMIN
+}
+
+model User {
+  id        String    @id @default(uuid())
+  name      String
+  email     String    @unique
+  password  String
+  verified  Boolean   @default(false)
+  role      UserRole  @default(USER)
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @default(now()) @updatedAt
+  removedAt DateTime?
+
+  profile     Profile?
+  reviews     Review[]
+  collections MediaCollection[]
+
+  @@map(name: "user")
+}
+
+enum Gender {
+  SECRET
+  MALE
+  FEMALE
+}
+
+enum Language {
+  KOREAN
+  ENGLISH
+  JAPANESE
+}
+
+model Profile {
+  id       Int      @id @default(autoincrement())
+  shortBio String?
+  avatar   String?
+  gender   Gender   @default(SECRET)
+  language Language @default(ENGLISH)
+
+  user   User   @relation(fields: [userId], references: [id])
+  userId String @unique
+
+  @@map(name: "profile")
+}
+
+model Review {
+  id        String   @id @default(uuid())
+  content   String
+  spoiler   Boolean  @default(true)
+  private   Boolean  @default(false)
+  likeCount Int      @default(0)
+  createdAt DateTime @default(now())
+  updatedAt DateTime @default(now()) @updatedAt
+
+  user    User   @relation(fields: [userId], references: [id])
+  userId  String
+  media   Media  @relation(fields: [mediaId], references: [id])
+  mediaId Int    @unique
+
+  @@map(name: "review")
+}
+
+model MediaCollection {
+  id          String    @id @default(uuid())
+  name        String
+  description String?
+  isCustom    Boolean   @default(true)
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime  @default(now()) @updatedAt
+  removedAt   DateTime?
+
+  user      User        @relation(fields: [userId], references: [id])
+  userId    String
+  mediaList MediaItem[]
+
+  @@map(name: "media_collection")
+}
+
+enum MediaItemStatus {
+  CURRENT
+  PLANNING
+  COMPLETED
+}
+
+model MediaItem {
+  id          Int             @id @default(autoincrement())
+  status      MediaItemStatus @default(PLANNING)
+  like        Boolean?
+  private     Boolean         @default(false)
+  repeat      Int             @default(0)
+  completedAt DateTime        @default(now())
+  createdAt   DateTime        @default(now())
+  updatedAt   DateTime        @default(now()) @updatedAt
+
+  collection   MediaCollection @relation(fields: [collectionId], references: [id])
+  collectionId String
+  media        Media           @relation(fields: [mediaId], references: [id])
+  mediaId      Int             @unique
+
+  @@map(name: "media_item")
+}
+
+enum Format {
+  TVA
+  OVA
+  ONA
+  MOVIE
+  MUSIC
+  SPECIAL
+}
+
+enum MediaStatus {
+  RELEASING
+  FINISHED
+  UNRELEASED
+  CANCELLED
+}
+
+model Media {
+  id           Int          @id @default(autoincrement())
+  title        String
+  image        String?
+  likeCount    Int          @default(0)
+  dislikeCount Int          @default(0)
+  synopsis     String?
+  studio       String?
+  format       Format?
+  startDate    DateTime?
+  endDate      DateTime?
+  episodeCount Int?
+  status       MediaStatus?
+  createdAt    DateTime     @default(now())
+  updatedAt    DateTime     @default(now()) @updatedAt
+  removedAt    DateTime?
+
+  genres    Genre[]     @relation(references: [id])
+  reviews   Review[]
+  mediaList MediaItem[]
+
+  @@index([title, studio])
+  @@map(name: "media")
+}
+
+model Genre {
+  id   Int    @id @default(autoincrement())
+  name String
+
+  media Media[] @relation(references: [id])
+
+  @@map(name: "genre")
+}
```


