# Migration `20201119095445-add-unique-item-required`

This migration has been generated by reisyun at 11/19/2020, 6:54:50 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "record" DROP CONSTRAINT "record_pkey",
ADD COLUMN "id" SERIAL,
ADD PRIMARY KEY ("id")

CREATE UNIQUE INDEX "library.userId_unique" ON "library"("userId")

CREATE UNIQUE INDEX "record.mediaId_unique" ON "record"("mediaId")

CREATE UNIQUE INDEX "review.userId_unique" ON "review"("userId")

CREATE UNIQUE INDEX "review.mediaId_unique" ON "review"("mediaId")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201005012017-initialize..20201119095445-add-unique-item-required
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -65,9 +65,9 @@
   updatedAt   DateTime  @default(now()) @updatedAt
   removedAt   DateTime?
   user    User     @relation(fields: [userId], references: [id])
-  userId  String
+  userId  String   @unique
   records Record[]
   @@map(name: "library")
 }
@@ -78,8 +78,9 @@
   COMPLETED
 }
 model Record {
+  id          Int          @id @default(autoincrement())
   status      RecordStatus @default(PLANNING)
   like        Boolean?
   completedAt DateTime     @default(now())
   createdAt   DateTime     @default(now())
@@ -87,9 +88,9 @@
   library   Library @relation(fields: [libraryId], references: [id])
   libraryId String
   media     Media   @relation(fields: [mediaId], references: [id])
-  mediaId   Int     @id
+  mediaId   Int     @unique
   @@map(name: "record")
 }
@@ -103,11 +104,11 @@
   createdAt DateTime @default(now())
   updatedAt DateTime @default(now()) @updatedAt
   user    User   @relation(fields: [userId], references: [id])
-  userId  String
+  userId  String @unique
   media   Media  @relation(fields: [mediaId], references: [id])
-  mediaId Int
+  mediaId Int    @unique
   @@map(name: "review")
 }
```


